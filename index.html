<!DOCTYPE html>
<html lang="en" class="transition-colors duration-700"> <!-- Slower theme transition -->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parcel Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
  <!-- Load tsparticles bundle for basic functionality -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.9.3/tsparticles.bundle.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Slightly deeper/richer primary palette for ambient feel
            primary: { 50: '#dbeafe', 100: '#bfdbfe', 200: '#93c5fd', 300: '#60a5fa', 400: '#3b82f6', 500: '#2563eb', 600: '#1d4ed8', 700: '#1e3a8a', 800: '#1e40af', 900: '#1d3675' }, // Darker blues
            surface: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a' },
            // Slightly richer accent palette
            accent: { purple: '#8b5cf6', pink: '#ec4899', emerald: '#10b981', orange: '#f59e0b', cyan: '#06b6d4' } // Kept original rich accents
          },
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          animation: {
            // Slower, gentler animations for ambient feel
            'fade-in': 'fadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
            'fade-in-up': 'fadeInUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
            'slide-up': 'slideUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
            'slide-in-right': 'slideInRight 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-gentle': 'bounceGentle 3s ease-in-out infinite',
            'shimmer': 'shimmer 3s linear infinite',
            'glow': 'glow 3s ease-in-out infinite alternate',
            'float': 'float 4s ease-in-out infinite',
            'scale-in': 'scaleIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
            'ripple': 'ripple 0.8s linear',
            'wiggle': 'wiggle 0.7s ease-in-out',
            'shake': 'shake 0.7s ease-in-out'
          },
          keyframes: {
            fadeIn: { '0%': { opacity: '0', transform: 'translateY(15px) scale(0.97)' }, '100%': { opacity: '1', transform: 'translateY(0) scale(1)' } },
            fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            slideInRight: { '0%': { opacity: '0', transform: 'translateX(20px)' }, '100%': { opacity: '1', transform: 'translateX(0)' } },
            bounceGentle: { '0%, 100%': { transform: 'translateY(-2px) rotate(-0.5deg)' }, '50%': { transform: 'translateY(1px) rotate(0.5deg)' } },
            shimmer: { '0%': { transform: 'translateX(-100%)' }, '100%': { transform: 'translateX(100%)' } },
            glow: { '0%': { boxShadow: '0 0 15px rgba(37, 99, 235, 0.25)' }, '100%': { boxShadow: '0 0 25px rgba(37, 99, 235, 0.4)' } }, // Adjusted glow color to primary-600
            float: { '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' }, '50%': { transform: 'translateY(-6px) rotate(0.5deg)' } },
            scaleIn: { '0%': { transform: 'scale(0.95)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
            ripple: { '0%': { transform: 'scale(0)', opacity: '0.7' }, '100%': { transform: 'scale(4)', opacity: '0' } },
            wiggle: { '0%, 100%': { transform: 'rotate(-1.5deg)' }, '50%': { transform: 'rotate(1.5deg)' } },
            shake: { '0%, 100%': { transform: 'translateX(0)' }, '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-3px)' }, '20%, 40%, 60%, 80%': { transform: 'translateX(3px)' } }
          },
          boxShadow: {
            // Softer, more diffused shadows
            'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
            'medium': '0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.03)',
            'large': '0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.02)',
            'glow': '0 0 20px rgba(37, 99, 235, 0.25)', // Adjusted glow color
            'inner-glow': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.05)'
          },
        }
      }
    }
  </script>
  <style>
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      font-family: 'Inter', sans-serif;
      /* Base gradient, particles will be on top */
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #c084fc 100%); /* Darker base */
      background-size: 600% 600%;
      animation: gradientShift 25s ease infinite;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .dark body {
      background: linear-gradient(135deg, #1e3a8a 0%, #312e81 50%, #433880 100%);
      background-size: 600% 600%;
      animation: gradientShift 25s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Particle container styling - Re-added */
    #tsparticles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1; /* Behind everything */
      opacity: 0.25; /* Adjust opacity for subtlety */
    }
    .dark #tsparticles {
        opacity: 0.2; /* Slightly less visible in dark mode */
    }

    /* Glass morphism with increased blur and adjusted opacity */
    .glass-morphism {
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      background: rgba(255, 255, 255, 0.12); /* Slightly less opaque */
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.12);
    }

    .dark .glass-morphism {
      background: rgba(15, 23, 42, 0.18); /* Slightly more opaque dark */
      border: 1px solid rgba(255, 255, 255, 0.09);
    }

    /* Subtle background pattern */
    .background-pattern {
      position: fixed;
      inset: 0;
      opacity: 0.02;
      background-image: radial-gradient(circle at 30px 30px, rgba(255, 255, 255, 0.2) 1.5px, transparent 0);
      background-size: 60px 60px;
      z-index: -1;
    }

    .dark .background-pattern {
      opacity: 0.03;
      background-image: radial-gradient(circle at 30px 30px, rgba(255, 255, 255, 0.1) 1.5px, transparent 0);
    }

    /* Header wave */
    .header-wave {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      overflow: hidden;
      line-height: 0;
      transform: rotate(180deg);
    }

    .header-wave svg {
      position: relative;
      display: block;
      width: calc(100% + 1.3px);
      height: 30px;
      transform: rotateY(180deg);
    }

    /* Parcel cards with softer hover effect */
    .parcel-card {
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      position: relative;
      overflow: hidden;
    }

    .dark .parcel-card {
      background: rgba(15, 23, 42, 0.28); /* Darker background */
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .parcel-card:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
    }

    /* Subtle hover line effect */
    .parcel-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.6), transparent); /* Adjusted color */
      transition: left 0.7s ease;
    }

    .parcel-card:hover::before {
      left: 100%;
    }

    /* Stats cards with softer hover */
    .stats-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .dark .stats-card {
      background: rgba(15, 23, 42, 0.28); /* Darker background */
    }

    .stats-card:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.09);
    }

    .stats-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
      transition: left 0.7s ease;
    }

    .stats-card:hover::before {
      left: 100%;
    }

    /* Form inputs */
    .form-input {
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(12px);
    }

    .dark .form-input {
      background: rgba(15, 23, 42, 0.22); /* Darker background */
    }

    .form-input:focus {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2); /* Adjusted glow color */
      background: rgba(255, 255, 255, 1);
    }

    .dark .form-input:focus {
      background: rgba(15, 23, 42, 0.38); /* Darker background on focus */
    }

    .form-input.error {
      border-color: #f87171 !important;
      animation: shake 0.7s ease-in-out;
    }

    /* Primary button with softer gradient and hover */
    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #7c3aed, #db2777); /* Darker/more saturated gradient */
      background-size: 300% 300%;
      animation: gradientShift 5s ease infinite;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }

    .btn-primary:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.35); /* Adjusted shadow */
    }

    .btn-primary:active {
      transform: translateY(-0.5px) scale(0.99);
      box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 1s, height 1s;
    }

    .btn-primary:hover::before {
      width: 500px;
      height: 500px;
    }

    /* Floating refresh button - slower, subtler animation */
    .floating-button {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2563eb, #7c3aed); /* Darker gradient */
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 50;
      animation: float 4s ease-in-out infinite;
    }

    .floating-button:hover {
      transform: scale(1.12) rotate(90deg);
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.45);
    }

    .floating-button:active {
      transform: scale(1.08) rotate(80deg);
    }

    /* Filter buttons - softer colors and hover */
    .filter-btn {
      padding: 0.75rem 1.4rem;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.5s ease;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #475569;
      white-space: nowrap;
      cursor: pointer;
      backdrop-filter: blur(12px);
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }

    .dark .filter-btn {
      background: rgba(15, 23, 42, 0.3); /* Darker background */
      border-color: rgba(255, 255, 255, 0.15);
      color: #94a3b8;
    }

    .filter-btn:hover {
      transform: translateY(-2px) scale(1.05);
      border-color: rgba(37, 99, 235, 0.6); /* Adjusted border color */
      color: #2563eb; /* Adjusted hover text */
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.25), 0 0 8px rgba(37, 99, 235, 0.3);
    }

    .filter-btn:active {
      transform: translateY(-0.5px) scale(1.01);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #2563eb, #7c3aed); /* Darker active gradient */
      color: white;
      border-color: transparent;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.25), 0 0 8px rgba(37, 99, 235, 0.3);
    }

    /* Status indicators - slightly adjusted colors for depth */
    .status-indicator {
      position: relative;
      background: linear-gradient(135deg, var(--status-color-1), var(--status-color-2));
      animation: float 4s ease-in-out infinite;
    }

    /* Slightly deeper status colors */
    .status-ready { --status-color-1: #059669; --status-color-2: #047857; } /* Deeper green */
    .status-transit { --status-color-1: #2563eb; --status-color-2: #1d4ed8; } /* Deeper blue */
    .status-error { --status-color-1: #dc2626; --status-color-2: #b91c1c; } /* Deeper red */
    .status-warehouse { --status-color-1: #7c3aed; --status-color-2: #6d28d9; } /* Deeper purple */

    .status-badge {
      position: relative;
      overflow: hidden;
      animation: pulse 3s infinite;
    }

    /* Search container focus effect */
    .search-container {
      position: relative;
    }

    .search-container:focus-within::before {
      opacity: 1;
    }

    .search-container::before {
      content: '';
      position: absolute;
      inset: 0;
      padding: 2px;
      background: linear-gradient(45deg, #2563eb, #7c3aed, #db2777); /* Darker gradient */
      border-radius: inherit;
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: xor;
      -webkit-mask-composite: xor;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    /* Search input */
    .search-input {
      transition: all 0.4s ease;
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(18px);
    }

    .dark .search-input {
      background: rgba(15, 23, 42, 0.28); /* Darker background */
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 60;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .notification.show {
      transform: translateX(0) scale(1);
      animation: slideInRight 0.5s ease;
    }

    /* Progress bar */
    .progress-bar {
      height: 3px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 1.5px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #2563eb); /* Adjusted colors */
      border-radius: 1.5px;
      transition: width 0.6s ease;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 2.5s infinite;
    }

    /* Ripple effect */
    .ripple-effect::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: scale(0);
      animation: ripple 0.8s linear;
      pointer-events: none;
    }

    /* Loading skeleton */
    .loading-skeleton {
      background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
      background-size: 300% 100%;
      animation: shimmer 3s infinite;
    }

    .dark .loading-skeleton {
      background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
    }

    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.03);
      border-radius: 10px;
    }

    .dark .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.03);
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.25), rgba(124, 58, 237, 0.25)); /* Adjusted thumb */
      border-radius: 10px;
      border: 1px solid transparent;
      background-clip: padding-box;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.35), rgba(124, 58, 237, 0.35));
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .glass-morphism {
        margin: 0.75rem;
        backdrop-filter: blur(25px);
      }

      .floating-button {
        bottom: 1rem;
        right: 1rem;
        width: 52px;
        height: 52px;
      }

      .notification {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        transform: translateY(-100px);
      }

      .notification.show {
        transform: translateY(0);
      }

      .filter-btn {
        padding: 0.6rem 1rem;
        font-size: 0.75rem;
        gap: 0.3rem;
      }
    }

    /* Reduce motion preference */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
       #tsparticles {
           display: none; /* Hide particles if reduced motion is preferred */
       }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <!-- Particle container - Re-added -->
  <div id="tsparticles"></div>
  <div class="background-pattern"></div>
  <div class="glass-morphism rounded-3xl w-full max-w-lg overflow-hidden animate-fade-in shadow-large">
    <header class="relative overflow-hidden">
      <div class="bg-gradient-to-r from-primary-500 via-purple-500 to-pink-500 px-6 py-7 relative"> <!-- Kept original vibrant header -->
        <div class="absolute inset-0 bg-gradient-to-r from-primary-600/20 to-purple-600/20"></div>
        <div class="flex items-center justify-between relative z-10">
          <div class="flex items-center gap-3">
            <div class="bg-white/25 rounded-2xl p-2.5 animate-bounce-gentle shadow-inner-glow">
              <span class="material-symbols-outlined text-white text-2xl">local_shipping</span>
            </div>
            <div>
              <h1 class="text-xl font-semibold text-white mb-0.5">Parcel Tracker</h1>
              <p class="text-white/85 text-xs font-normal">Track your shipments</p>
            </div>
          </div>
          <div class="flex items-center gap-2.5">
            <button id="themeToggle" class="bg-white/25 hover:bg-white/35 rounded-xl p-2 transition-all duration-400 hover:scale-105 ripple-effect" title="Toggle Dark Mode">
              <span class="material-symbols-outlined text-white text-lg" id="themeIcon">dark_mode</span>
            </button>
          </div>
        </div>
        <div class="header-wave">
          <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
            <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="fill-white dark:fill-surface-800"></path>
          </svg>
        </div>
      </div>
    </header>
    <main class="p-5 bg-white/90 dark:bg-surface-800/90 backdrop-blur-sm">
      <form id="trackingForm" class="space-y-5" novalidate>
        <div class="relative group">
          <label for="email" class="absolute -top-2.5 left-3.5 bg-white dark:bg-surface-800 px-2.5 text-xs font-medium text-surface-500 dark:text-surface-400 transition-all duration-300 group-focus-within:text-primary-500 z-10 rounded-full">Email Address</label>
          <input id="email" type="email" required autocomplete="username" class="form-input w-full px-7 py-3.5 pr-11 text-surface-800 dark:text-surface-200 border border-surface-200 dark:border-surface-600 rounded-2xl focus:outline-none focus:border-primary-500 focus:shadow-glow font-normal" placeholder="Enter your email">
          <div class="absolute right-3.5 top-3.5 text-surface-400 pointer-events-none transition-colors duration-200 group-focus-within:text-primary-500">
            <span class="material-symbols-outlined text-sm">email</span>
          </div>
          <div class="error-message hidden text-red-400 text-xs mt-1.5 flex items-center gap-1.5">
            <span class="material-symbols-outlined text-xs">error</span>
            <span></span>
          </div>
        </div>
        <div class="relative group">
          <label for="password" class="absolute -top-2.5 left-3.5 bg-white dark:bg-surface-800 px-2.5 text-xs font-medium text-surface-500 dark:text-surface-400 transition-all duration-300 group-focus-within:text-primary-500 z-10 rounded-full">Password</label>
          <input id="password" type="password" required autocomplete="current-password" class="form-input w-full px-7 py-3.5 pr-11 text-surface-800 dark:text-surface-200 border border-surface-200 dark:border-surface-600 rounded-2xl focus:outline-none focus:border-primary-500 focus:shadow-glow font-normal" placeholder="Enter your password">
          <button type="button" id="togglePassword" class="absolute right-3.5 top-3.5 text-surface-400 hover:text-surface-600 transition-all duration-200 z-10 hover:scale-110">
            <span class="material-symbols-outlined text-sm" id="passwordIcon">visibility_off</span>
          </button>
          <div class="error-message hidden text-red-400 text-xs mt-1.5 flex items-center gap-1.5">
            <span class="material-symbols-outlined text-xs">error</span>
            <span></span>
          </div>
        </div>
        <button type="submit" id="submitBtn" class="btn-primary w-full py-3.5 px-5 rounded-2xl text-white font-semibold text-base shadow-glow focus:outline-none focus:ring-2 focus:ring-primary-200 disabled:opacity-70 disabled:cursor-not-allowed relative z-10 ripple-effect">
          <span id="btnText" class="relative z-10">Track My Parcels</span>
          <div id="btnLoader" class="absolute inset-0 flex items-center justify-center opacity-0 transition-opacity duration-300">
            <div class="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
          </div>
        </button>
      </form>
      <div id="statsContainer" class="hidden mt-7 grid grid-cols-2 md:grid-cols-4 gap-3.5">
        <div class="stats-card text-center p-3.5 bg-gradient-to-br from-emerald-50/80 to-green-100/80 dark:from-emerald-900/25 dark:to-green-900/25 rounded-2xl shadow-soft">
          <div class="text-2xl font-extrabold text-emerald-600 dark:text-emerald-400 mb-1" id="readyCount">0</div>
          <div class="text-xs font-medium text-emerald-700 dark:text-emerald-300 uppercase tracking-wider">Ready</div>
        </div>
        <div class="stats-card text-center p-3.5 bg-gradient-to-br from-violet-50/80 to-purple-100/80 dark:from-violet-900/25 dark:to-purple-900/25 rounded-2xl shadow-soft">
          <div class="text-2xl font-extrabold text-violet-600 dark:text-violet-400 mb-1" id="warehouseCount">0</div>
          <div class="text-xs font-medium text-violet-700 dark:text-violet-300 uppercase tracking-wider">Warehouse</div>
        </div>
        <div class="stats-card text-center p-3.5 bg-gradient-to-br from-blue-50/80 to-cyan-100/80 dark:from-blue-900/25 dark:to-cyan-900/25 rounded-2xl shadow-soft">
          <div class="text-2xl font-extrabold text-blue-600 dark:text-blue-400 mb-1" id="transitCount">0</div>
          <div class="text-xs font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wider">In Transit</div>
        </div>
        <div class="stats-card text-center p-3.5 bg-gradient-to-br from-purple-50/80 to-indigo-100/80 dark:from-purple-900/25 dark:to-indigo-900/25 rounded-2xl shadow-soft">
          <div class="text-2xl font-extrabold text-purple-600 dark:text-purple-400 mb-1" id="totalCount">0</div>
          <div class="text-xs font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wider">Total</div>
        </div>
      </div>
      <div id="searchContainer" class="hidden mt-7 space-y-3.5">
        <div class="flex gap-2.5 overflow-x-auto overflow-y-visible pt-1.5 pb-2.5 -mx-5 px-5">
          <button class="filter-btn active" data-filter="all" title="All Parcels">
            <span class="material-symbols-outlined text-sm">apps</span>
          </button>
          <button class="filter-btn" data-filter="Ready to Pickup" title="Ready to Pickup">
            <span class="material-symbols-outlined text-sm">inventory_2</span>
          </button>
          <button class="filter-btn" data-filter="In the Warehouse" title="In the Warehouse">
            <span class="material-symbols-outlined text-sm">warehouse</span>
          </button>
          <button class="filter-btn" data-filter="В пути" title="Shipped (В пути)">
            <span class="material-symbols-outlined text-sm">local_shipping</span>
          </button>
          <button class="filter-btn" data-filter="In transit" title="In Transit">
            <span class="material-symbols-outlined text-sm">flight</span>
          </button>
          <button class="filter-btn" data-filter="Not Arrived" title="Not Arrived / Pending">
            <span class="material-symbols-outlined text-sm">schedule</span>
          </button>
        </div>
      </div>
      <div id="results" class="mt-7 space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar -mx-5 px-5">
        <div id="loadingPlaceholder" class="hidden space-y-4">
          <div class="loading-skeleton h-22 rounded-3xl"></div>
          <div class="loading-skeleton h-22 rounded-3xl"></div>
          <div class="loading-skeleton h-22 rounded-3xl"></div>
        </div>
        <div id="emptyState" class="text-center py-14 animate-fade-in-up">
          <div class="mx-auto w-22 h-22 bg-gradient-to-br from-primary-100/80 to-purple-100/80 dark:from-primary-900/25 dark:to-purple-900/25 rounded-3xl flex items-center justify-center mb-5 shadow-soft animate-float">
            <span class="material-symbols-outlined text-4xl text-primary-500 dark:text-primary-400">package_2</span>
          </div>
          <h3 class="text-lg font-semibold text-surface-700 dark:text-surface-300 mb-2.5">No Parcels Yet</h3>
          <p class="text-surface-500 dark:text-surface-400 max-w-xs mx-auto text-sm leading-relaxed">Enter your credentials to track your shipments.</p>
        </div>
      </div>
    </main>
  </div>
  <button id="refreshBtn" class="floating-button hidden items-center justify-center text-white group">
    <span class="material-symbols-outlined text-xl transition-transform duration-400 group-hover:rotate-90">refresh</span>
  </button>
  <div id="notification" class="notification">
    <div class="bg-white/90 dark:bg-surface-800/90 backdrop-blur-sm rounded-3xl shadow-large p-4.5 border border-surface-200 dark:border-surface-600 min-w-[300px] animate-scale-in">
      <div class="flex items-start gap-3.5">
        <div class="p-1.5 rounded-2xl" id="notificationIconContainer">
          <span id="notificationIcon" class="material-symbols-outlined text-xl"></span>
        </div>
        <div class="flex-1">
          <div id="notificationTitle" class="font-semibold text-surface-800 dark:text-surface-200 text-base"></div>
          <div id="notificationMessage" class="text-xs text-surface-600 dark:text-surface-400 mt-1 leading-relaxed"></div>
          <div class="progress-bar mt-2.5" id="notificationProgress">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
        </div>
        <button id="closeNotification" class="text-surface-400 hover:text-surface-600 transition-all duration-200 hover:scale-110 p-1 rounded-lg hover:bg-surface-100 dark:hover:bg-surface-700">
          <span class="material-symbols-outlined text-sm">close</span>
        </button>
      </div>
    </div>
  </div>
  <script>
    // --- DOM Elements ---
    const form = document.getElementById('trackingForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const results = document.getElementById('results');
    const loadingPlaceholder = document.getElementById('loadingPlaceholder');
    const emptyState = document.getElementById('emptyState');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnLoader = document.getElementById('btnLoader');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const togglePassword = document.getElementById('togglePassword');
    const passwordIcon = document.getElementById('passwordIcon');
    const refreshBtn = document.getElementById('refreshBtn');
    const searchContainer = document.getElementById('searchContainer');
    const statsContainer = document.getElementById('statsContainer');
    const notification = document.getElementById('notification');
    const closeNotification = document.getElementById('closeNotification');
    // --- State Management ---
    let allParcels = [];
    let filteredParcels = [];
    let currentFilter = 'all';
    let lastRefreshTime = null;
    let timeUpdateInterval;
    // --- VALIDATION ---
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
    function validatePassword(password) {
      return password.length >= 6;
    }
    function showFieldError(field, message) {
      const input = field === 'email' ? emailInput : passwordInput;
      const errorDiv = input.parentElement.querySelector('.error-message');
      const errorSpan = errorDiv.querySelector('span:last-child');
      input.classList.add('error');
      errorSpan.textContent = message;
      errorDiv.classList.remove('hidden');
      setTimeout(() => {
        input.classList.remove('error');
        errorDiv.classList.add('hidden');
      }, 5000);
    }
    function clearFieldErrors() {
      document.querySelectorAll('.form-input').forEach(input => {
        input.classList.remove('error');
      });
      document.querySelectorAll('.error-message').forEach(error => {
        error.classList.add('hidden');
      });
    }
    // --- UI & THEME ---
    function setLoadingState(isLoading) {
      submitBtn.disabled = isLoading;
      if (isLoading) {
        btnText.style.opacity = '0';
        btnLoader.style.opacity = '1';
        results.innerHTML = '';
        loadingPlaceholder.classList.remove('hidden');
        emptyState.classList.add('hidden');
      } else {
        btnText.style.opacity = '1';
        btnLoader.style.opacity = '0';
        loadingPlaceholder.classList.add('hidden');
      }
    }
    function showNotification(title, message, icon = 'info', type = 'info', duration = 4000, showProgress = false) {
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      const notificationIcon = document.getElementById('notificationIcon');
      const notificationIconContainer = document.getElementById('notificationIconContainer');
      const progressBar = document.getElementById('notificationProgress');
      const progressFill = document.getElementById('progressFill');
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      notificationIcon.textContent = icon;
      const typeStyles = {
        success: 'bg-emerald-100/80 dark:bg-emerald-900/25 text-emerald-600 dark:text-emerald-400',
        error: 'bg-red-100/80 dark:bg-red-900/25 text-red-600 dark:text-red-400',
        warning: 'bg-orange-100/80 dark:bg-orange-900/25 text-orange-600 dark:text-orange-400',
        info: 'bg-blue-100/80 dark:bg-blue-900/25 text-blue-600 dark:text-blue-400'
      };
      notificationIconContainer.className = `p-1.5 rounded-2xl ${typeStyles[type] || typeStyles.info}`;
      if (showProgress) {
        progressBar.classList.remove('hidden');
        progressFill.style.transition = `width ${duration / 1000}s linear`;
        progressFill.style.width = '100%';
        setTimeout(() => {
            progressFill.style.width = '0%';
        }, 100);
      } else {
        progressBar.classList.add('hidden');
      }
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), duration);
    }
    function addRippleEffect(e) {
      const btn = e.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(btn.clientWidth, btn.clientHeight);
      const radius = diameter / 2;
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - btn.offsetLeft - radius}px`;
      circle.style.top = `${e.clientY - btn.offsetTop - radius}px`;
      circle.classList.add("ripple-effect");
      const ripple = btn.getElementsByClassName("ripple-effect")[0];
      if (ripple) {
        ripple.remove();
      }
      btn.appendChild(circle);
    }
    // --- DATA & RENDERING ---
    function filterAndDisplayResults() {
      let parcelsToDisplay = allParcels;
      if (currentFilter !== 'all') {
        parcelsToDisplay = allParcels.filter(item => item.status === currentFilter);
      }
      filteredParcels = parcelsToDisplay;

      // Apply a fade-out effect to the current results container
      results.style.opacity = '0';
      results.style.transform = 'translateY(15px)';
      results.style.transition = 'opacity 0.4s ease, transform 0.4s ease';

      // Render results after a short delay to allow the fade-out
      setTimeout(() => {
         renderResults(filteredParcels);
         // Apply a fade-in effect to the new results
         results.style.opacity = '1';
         results.style.transform = 'translateY(0)';
      }, 400);
    }
    function renderResults(parcels) {
      results.innerHTML = '';
      if (parcels.length === 0) {
        results.innerHTML = renderNoResultsState();
        return;
      }
      emptyState.classList.add('hidden');
      parcels.forEach((item, index) => {
        const parcelCard = createParcelCard(item, index);
        results.appendChild(parcelCard);
      });
    }
    function createParcelCard(item, index) {
      // Slightly deeper status config
      const statusConfig = {
        'Ready to Pickup': { color: 'text-emerald-600 dark:text-emerald-400', bg: 'bg-gradient-to-br from-emerald-100/85 to-green-200/85 dark:from-emerald-900/30', icon: 'inventory_2', pulse: 'animate-pulse' },
        'In the Warehouse': { color: 'text-purple-600 dark:text-purple-400', bg: 'bg-gradient-to-br from-purple-100/85 to-violet-200/85 dark:from-purple-900/30', icon: 'warehouse', pulse: '' },
        'В пути': { color: 'text-blue-600 dark:text-blue-400', bg: 'bg-gradient-to-br from-blue-100/85 to-cyan-200/85 dark:from-blue-900/30', icon: 'local_shipping', pulse: '' },
        'In transit': { color: 'text-cyan-600 dark:text-cyan-400', bg: 'bg-gradient-to-br from-cyan-100/85 to-blue-200/85 dark:from-cyan-900/30', icon: 'flight', pulse: 'animate-pulse' },
        'Not Arrived': { color: 'text-orange-600 dark:text-orange-400', bg: 'bg-gradient-to-br from-orange-100/85 to-yellow-200/85 dark:from-orange-900/30', icon: 'schedule', pulse: '' },
        'Delivered': { color: 'text-indigo-600 dark:text-indigo-400', bg: 'bg-gradient-to-br from-indigo-100/85 to-purple-200/85 dark:from-indigo-900/30', icon: 'task_alt', pulse: '' },
        'Ошибка': { color: 'text-red-600 dark:text-red-400', bg: 'bg-gradient-to-br from-red-100/85 to-pink-200/85 dark:from-red-900/30', icon: 'error', pulse: '' },
      };
      const config = statusConfig[item.status] || statusConfig['Not Arrived'];
      const card = document.createElement('div');
      card.className = 'parcel-card p-5 animate-slide-up shadow-medium rounded-3xl border border-surface-200/50 dark:border-surface-600/50 group';
      card.style.animationDelay = `${index * 120}ms`;
      card.innerHTML = `
        <div class="flex items-start gap-4">
          <div class="status-indicator ${config.bg} p-3.5 rounded-2xl ${config.pulse || ''} group-hover:scale-105 transition-transform duration-400">
            <span class="material-symbols-outlined ${config.color} text-2xl">${config.icon}</span>
          </div>
          <div class="flex-1 min-w-0">
            <div class="flex justify-between items-start mb-2.5">
              <div class="font-semibold text-surface-800 dark:text-surface-200 text-base truncate pr-2.5" title="${item.trackingCode || ''}">${item.trackingCode || 'No tracking code'}</div>
              <span class="status-badge ${config.bg} ${config.color} px-3 py-1.5 rounded-full text-xs font-semibold whitespace-nowrap shadow-soft ${config.pulse ? 'animate-none' : ''}">${item.status || 'Unknown'}</span>
            </div>
            <p class="text-surface-600 dark:text-surface-400 mb-3.5 text-sm font-normal">${item.packageName || 'No description'}</p>
            <div class="flex justify-between items-center">
              <div class="time-ago text-xs text-surface-400 font-normal flex items-center gap-1.5">
                <span class="material-symbols-outlined text-xs text-primary-500">schedule</span>
                <span class="bg-primary-50/80 dark:bg-primary-900/25 text-primary-600 dark:text-primary-400 px-1.5 py-0.5 rounded-md"></span>
              </div>
              <div class="flex items-center gap-1.5">
                <button class="copy-btn bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 text-white px-3 py-1.5 rounded-xl text-xs font-semibold flex items-center gap-1.5 transition-all hover:scale-105 shadow-soft hover:shadow-glow">
                  <span class="material-symbols-outlined text-xs">content_copy</span>
                  Copy
                </button>
              </div>
            </div>
          </div>
        </div>`;
      const copyBtn = card.querySelector('.copy-btn');
      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(item.trackingCode || '');
          showNotification('Success!', 'Tracking code copied.', 'content_copy', 'success', 2500, true);
          const originalHTML = copyBtn.innerHTML;
          copyBtn.innerHTML = `<span class="material-symbols-outlined text-xs">done</span> Copied!`;
          copyBtn.style.transform = 'scale(1.08)';
          setTimeout(() => {
             copyBtn.style.transform = 'scale(1)';
             setTimeout(() => {
                 copyBtn.innerHTML = originalHTML;
             }, 100);
          }, 2000);
        } catch (err) {
          showNotification('Copy Failed', 'Could not copy.', 'error', 'error');
        }
      });
      return card;
    }
    function renderNoResultsState() {
      const message = allParcels.length > 0
        ? `<h3 class="text-base font-semibold text-surface-700 dark:text-surface-300 mb-1.5">No Parcels Found</h3><p class="text-surface-500 dark:text-surface-400 text-sm">Try a different filter.</p>`
        : `<h3 class="text-lg font-semibold text-surface-700 dark:text-surface-300 mb-2.5">No Parcels Yet</h3><p class="text-surface-500 dark:text-surface-400 max-w-xs mx-auto text-sm leading-relaxed">Enter your credentials to track your shipments.</p>`;
      const icon = allParcels.length > 0 ? 'filter_list_off' : 'package_2';
      return `
        <div class="text-center py-12 animate-fade-in-up">
          <div class="mx-auto w-18 h-18 bg-gradient-to-br from-orange-100/80 to-red-100/80 dark:from-orange-900/25 rounded-3xl flex items-center justify-center mb-5 shadow-soft animate-float">
            <span class="material-symbols-outlined text-3xl text-orange-500">${icon}</span>
          </div>
          ${message}
        </div>`;
    }
    // UPDATED: updateStats now calculates and animates the "warehouse" count
    function updateStats() {
      const stats = {
        ready: allParcels.filter(p => p.status === 'Ready to Pickup').length,
        warehouse: allParcels.filter(p => p.status === 'In the Warehouse').length,
        transit: allParcels.filter(p => p.status === 'В пути' || p.status === 'In transit').length,
        total: allParcels.length
      };
      animateCounter(document.getElementById('readyCount'), stats.ready);
      animateCounter(document.getElementById('warehouseCount'), stats.warehouse);
      animateCounter(document.getElementById('transitCount'), stats.transit);
      animateCounter(document.getElementById('totalCount'), stats.total);
    }
    function animateCounter(element, targetValue) {
      const startValue = parseInt(element.textContent) || 0;
      if (startValue === targetValue) return;
      const duration = 1000;
      let startTime = null;
      function animationStep(currentTime) {
        if (!startTime) startTime = currentTime;
        const progress = Math.min((currentTime - startTime) / duration, 1);

        // Use a smooth easing function (ease-out-quart)
        const easedProgress = 1 - Math.pow(1 - progress, 4);

        const currentValue = Math.floor(easedProgress * (targetValue - startValue) + startValue);
        element.textContent = currentValue;
        if (progress < 1) {
          requestAnimationFrame(animationStep);
        }
      }
      requestAnimationFrame(animationStep);
    }
    // --- TIME UPDATE ---
    function updateTimeAgo() {
      if (!lastRefreshTime) return;
      const timeElements = document.querySelectorAll('.time-ago span:last-child');
      timeElements.forEach(el => {
        const seconds = Math.floor((Date.now() - lastRefreshTime) / 1000);
        if (seconds < 5) {
            el.textContent = 'Just now';
        } else if (seconds < 60) {
            el.textContent = `${seconds}s ago`;
        } else {
            el.textContent = `${Math.floor(seconds / 60)}m ago`;
        }
      });
    }
    // --- EVENT LISTENERS ---
    async function handleFormSubmit(event) {
      event.preventDefault();
      clearFieldErrors();
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      let hasErrors = false;
      if (!validateEmail(email)) {
        showFieldError('email', 'Please enter a valid email address'); hasErrors = true;
      }
      if (!validatePassword(password)) {
        showFieldError('password', 'Password must be at least 6 characters'); hasErrors = true;
      }
      if (hasErrors) {
        showNotification('Validation Error', 'Please fix the errors.', 'error', 'error');
        return;
      }
      setLoadingState(true);
      try {
        const res = await fetch('/check', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (!res.ok) {
          throw new Error(data.error || `Server error: ${res.status}`);
        }
        lastRefreshTime = Date.now();
        allParcels = data;
        if (data.length === 0) {
          showNotification('No Parcels', 'No shipments found.', 'info', 'warning', 4000, true);
        } else {
          showNotification('Success!', `Found ${data.length} parcel(s).`, 'check_circle', 'success', 3000, true);
          searchContainer.classList.remove('hidden');
          statsContainer.classList.remove('hidden');
          refreshBtn.classList.remove('hidden');
          refreshBtn.classList.add('flex');
        }
        filterAndDisplayResults();
        updateStats();
        updateTimeAgo();
      } catch (err) {
        showNotification('Request Failed', err.message, 'error', 'error', 5000);
        results.innerHTML = `<div class="text-center py-12 animate-fade-in-up text-red-500 flex flex-col items-center gap-3.5">
          <div class="w-14 h-14 bg-red-100/80 dark:bg-red-900/25 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-2xl text-red-500">error</span>
          </div>
          <div><h3 class="font-semibold text-base mb-1.5">Connection Failed</h3><p class="text-xs">${err.message}</p></div>
        </div>`;
      } finally {
        setLoadingState(false);
      }
    }
    // --- INITIALIZATION & BINDINGS ---
    function init() {
      // Theme setup
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
        themeIcon.textContent = 'light_mode';
      }

       // --- PARTICLES.JS INITIALIZATION - Re-added ---
       // Define the particles configuration
        const particlesConfig = {
            fpsLimit: 120,
            particles: {
                number: {
                    value: 80, // Adjust number of particles
                    density: {
                        enable: true,
                        area: 800
                    }
                },
                color: {
                    value: ["#3b82f6", "#8b5cf6", "#ec4899", "#ffffff"], // Blue, Purple, Pink, White
                },
                shape: {
                    type: "circle", // Circle particles
                },
                opacity: {
                    value: { min: 0.1, max: 0.5 }, // Variable opacity
                    animation: {
                        enable: true,
                        speed: 1,
                        minimumValue: 0.1,
                        sync: false
                    }
                },
                size: {
                    value: { min: 1, max: 3 }, // Variable size
                },
                links: {
                    enable: true,
                    distance: 150,
                    color: "#ffffff", // White links
                    opacity: 0.2, // Faint links
                    width: 1
                },
                move: {
                    enable: true,
                    speed: { min: 0.1, max: 1 }, // Slow movement
                    direction: "none",
                    random: true, // Random movement
                    straight: false,
                    outModes: "out", // Particles go out of canvas
                }
            },
            interactivity: {
                detectsOn: "window", // Interact with mouse anywhere
                events: {
                    onhover: {
                        enable: true,
                        mode: "grab" // Grab links on hover
                    },
                    onclick: {
                        enable: true,
                        mode: "push" // Push particles on click
                    },
                    resize: true
                },
                modes: {
                    grab: {
                        distance: 140,
                        links: {
                            opacity: 0.5 // Stronger links on grab
                        }
                    },
                    push: {
                        quantity: 4 // Push 4 particles on click
                    }
                }
            },
            detectRetina: true
        };

        // Load the particles configuration when the DOM is ready
        if (tsParticles) {
            tsParticles.load("tsparticles", particlesConfig).catch((error) => {
                console.error("Error loading particles:", error);
                // If particles fail, the background will still have the animated gradient
            });
        }


      // Event bindings
      form.addEventListener('submit', handleFormSubmit);

      // Add subtle press effect to the main submit button
      submitBtn.addEventListener('mousedown', () => {
          submitBtn.style.transform = 'translateY(-0.5px) scale(0.99)';
          submitBtn.style.boxShadow = '0 5px 15px rgba(37, 99, 235, 0.3)';
      });
      submitBtn.addEventListener('mouseup', () => {
          submitBtn.style.transform = '';
          submitBtn.style.boxShadow = '';
      });
      submitBtn.addEventListener('mouseleave', () => {
          submitBtn.style.transform = '';
          submitBtn.style.boxShadow = '';
      });

      refreshBtn.addEventListener('click', (e) => { addRippleEffect(e); handleFormSubmit(new Event('submit')); });

      // Add subtle press effect to the refresh button
       refreshBtn.addEventListener('mousedown', () => {
          refreshBtn.style.transform = 'scale(1.08) rotate(80deg)';
      });
      refreshBtn.addEventListener('mouseup', () => {
          refreshBtn.style.transform = '';
      });
      refreshBtn.addEventListener('mouseleave', () => {
          refreshBtn.style.transform = '';
      });

      themeToggle.addEventListener('click', (e) => {
        addRippleEffect(e);
        const isDark = document.documentElement.classList.toggle('dark');
        themeIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
         // Update particles color mode if needed (optional, tsparticles handles some automatically)
        // You could potentially re-init particles here for a different dark/light config if desired.
      });
      togglePassword.addEventListener('click', (e) => {
        addRippleEffect(e);
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        passwordIcon.textContent = isPassword ? 'visibility' : 'visibility_off';
      });
      document.querySelector('#searchContainer').addEventListener('click', (e) => {
        const filterBtn = e.target.closest('.filter-btn');
        if (filterBtn) {
          addRippleEffect(e);
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          filterBtn.classList.add('active');
          currentFilter = filterBtn.dataset.filter;
          filterAndDisplayResults();
        }
      });
      closeNotification.addEventListener('click', () => notification.classList.remove('show'));

      // Debounce filter transitions slightly for smoother feel
      let filterDebounceTimer;
      const originalFilterAndDisplayResults = filterAndDisplayResults;
      filterAndDisplayResults = function() {
        clearTimeout(filterDebounceTimer);
        filterDebounceTimer = setTimeout(originalFilterAndDisplayResults, 75);
      };

      // Start intervals
      timeUpdateInterval = setInterval(updateTimeAgo, 5000);
    }
    window.addEventListener('beforeunload', () => clearInterval(timeUpdateInterval));
    // Initialize when the page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        // DOM is already loaded
        init();
    }
  </script>
</body>
</html>
